- name: ðŸ”§ FIX - Check and Repair Gradle Wrapper
  run: |
    echo "=== Checking Gradle Wrapper ==="
    
    # 1. Cek apakah gradle-wrapper.jar sudah ada
    if [ -f gradle/wrapper/gradle-wrapper.jar ]; then
      echo "âœ… gradle-wrapper.jar already exists"
    else
      echo "âŒ gradle-wrapper.jar MISSING! Creating it..."
      mkdir -p gradle/wrapper
      
      # 2. Coba download dari beberapa sumber berbeda
      echo "Trying to download gradle-wrapper.jar..."
      
      # SUMBER 1: Dari Maven Central (lebih reliable)
      if curl -L -o gradle/wrapper/gradle-wrapper.jar \
         "https://repo.maven.apache.org/maven2/gradle/wrapper/gradle-wrapper/8.5/gradle-wrapper-8.5.jar"; then
        echo "âœ… Downloaded from Maven Central"
      else
        # SUMBER 2: Dari GitHub (alternatif)
        echo "Trying alternative source..."
        curl -L -o gradle/wrapper/gradle-wrapper.jar \
          "https://github.com/gradle/gradle/raw/refs/tags/v8.5/bin/gradle/wrapper/gradle-wrapper.jar"
      fi
      
      # 3. Verifikasi file berhasil didownload
      if [ -f gradle/wrapper/gradle-wrapper.jar ]; then
        echo "âœ… gradle-wrapper.jar successfully downloaded"
        ls -la gradle/wrapper/gradle-wrapper.jar
      else
        echo "âŒ ERROR: Failed to download gradle-wrapper.jar"
        echo "Creating empty file as fallback..."
        touch gradle/wrapper/gradle-wrapper.jar
      fi
    fi
    
    # 4. Buat gradle-wrapper.properties jika tidak ada
    if [ ! -f gradle/wrapper/gradle-wrapper.properties ]; then
      echo "Creating gradle-wrapper.properties..."
      echo "distributionBase=GRADLE_USER_HOME" > gradle/wrapper/gradle-wrapper.properties
      echo "distributionPath=wrapper/dists" >> gradle/wrapper/gradle-wrapper.properties
      echo "distributionUrl=https\://services.gradle.org/distributions/gradle-8.5-bin.zip" >> gradle/wrapper/gradle-wrapper.properties
      echo "zipStoreBase=GRADLE_USER_HOME" >> gradle/wrapper/gradle-wrapper.properties
      echo "zipStorePath=wrapper/dists" >> gradle/wrapper/gradle-wrapper.properties
    fi
    
    # 5. Pastikan gradlew executable
    if [ -f gradlew ]; then
      chmod +x gradlew
      echo "âœ… gradlew is now executable"
    else
      echo "âš ï¸  gradlew file not found, creating basic one..."
      echo '#!/usr/bin/env bash' > gradlew
      echo 'java -jar gradle/wrapper/gradle-wrapper.jar "$@"' >> gradlew
      chmod +x gradlew
    fi
    
    # 6. Tampilkan struktur folder
    echo "=== Final Structure ==="
    ls -la gradle/wrapper/
    echo "File size of gradle-wrapper.jar: $(wc -c < gradle/wrapper/gradle-wrapper.jar) bytes"
